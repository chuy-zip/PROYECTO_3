---
title: "EXPLORACION_NUMERICAS"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(dplyr)
library(kableExtra)
library(tidyr)
library(ggplot2)
library(hopkins)
library(factoextra) 
library(cluster)
```

```{r, include=FALSE}
data <- read.csv("train.csv")
```

```{r identificar_variables_num, echo=FALSE}

numeric_cols <- sapply(data, is.numeric)
numeric_data <- data[, numeric_cols, drop = FALSE]

if(ncol(numeric_data) == 0) {
  stop("No se encontraron variables numéricas en el dataset")
} else {
  cat("Variables numéricas encontradas:", ncol(numeric_data), "\n")
  cat("Nombres:", names(numeric_data), "\n")
}
```

```{r estadisticas_descriptivas, echo=FALSE}

calculate_stats <- function(df) {
  df %>%
    pivot_longer(everything(), names_to = "Variable", values_to = "Valor") %>%
    group_by(Variable) %>%
    summarise(
      Media = mean(Valor, na.rm = TRUE),
      Mediana = median(Valor, na.rm = TRUE),
      Desv_Estándar = sd(Valor, na.rm = TRUE),
      Mínimo = min(Valor, na.rm = TRUE),
      Máximo = max(Valor, na.rm = TRUE),
      Q1 = quantile(Valor, 0.25, na.rm = TRUE),
      Q3 = quantile(Valor, 0.75, na.rm = TRUE),
      IQR = IQR(Valor, na.rm = TRUE),
      N_NA = sum(is.na(Valor))
    ) %>%
    kable(format = "html", digits = 2) %>%
    kable_styling(bootstrap_options = c("striped", "hover"))
}

calculate_stats(numeric_data)
```

```{r visualizar_datos, echo=FALSE}
plot_histograms <- function(df) {
  df_long <- df %>% 
    pivot_longer(everything(), names_to = "Variable", values_to = "Valor")
  
  ggplot(df_long, aes(x = Valor)) +
    geom_histogram(aes(y = ..density..), bins = 30, fill = "skyblue", color = "black") +
    geom_density(color = "red", linewidth = 1) +
    facet_wrap(~Variable, scales = "free") +
    labs(title = "Distribución de variables numéricas", 
         x = "Valor", y = "Densidad") +
    theme_minimal()
}

plot_histograms(numeric_data)
```

```{r analisis_correlacion, echo=FALSE}
if(ncol(numeric_data) > 1) {
  # Matriz de correlación
  cor_matrix <- round(cor(numeric_data, use = "complete.obs"), 2)
  
  # ver de correlación
  corrplot::corrplot(cor_matrix, method = "color", type = "upper", 
                     tl.col = "black", tl.srt = 45, 
                     addCoef.col = "black", number.cex = 0.7)
  
  # Heatmap
  ggplot(data = reshape2::melt(cor_matrix), 
         aes(x = Var1, y = Var2, fill = value)) +
    geom_tile() +
    geom_text(aes(label = value), color = "black", size = 3) +
    scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                        midpoint = 0, limit = c(-1,1)) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
    labs(title = "Matriz de correlación", x = "", y = "", fill = "Correlación")
}
```

# Relaciones entre variables (clustering)

## Estadistico de Hopkins
```{r estadistico_hopkins, echo=FALSE}
numeric_cols <- sapply(data, is.numeric)
numeric_data <- data[, numeric_cols, drop = FALSE]
variables_numericas <- na.omit(variables_numericas)
data <- data[complete.cases(data[, numeric_cols]), ]

dim(numeric_data)
dim(data)
set.seed(123)

hopkins_stat <- hopkins(variables_numericas)

# Mostrar el resultado
print(paste("Estadistico de Hopkins:", hopkins_stat))

```

## Grafico de codo
```{r Grafico_codo, echo=FALSE}
wss=0
set.seed(123)
for (i in 1:10) 
  wss[i] <- sum(kmeans(variables_numericas, centers=i)$withinss)

plot(1:10, wss, type="b", xlab="Number of Clusters",  ylab="Within groups sum of squares")
```

```{r clustering_kmeans, echo=FALSE}
k_optimo <- 3 

# Aplicar K-Means
set.seed(123)
km <- kmeans(variables_numericas, centers = k_optimo, iter.max =100)

# Visualizar los clusters con fviz_cluster
fviz_cluster(km, data = variables_numericas, geom = "point", ellipse.type = "norm")
```

```{r clustering_eval_silueta, echo=FALSE}
silkm <- silhouette(km$cluster, dist(variables_numericas))
silueta_promedio <- mean(silkm[, 3])
print(paste("Coeficiente de silueta promedio:", silueta_promedio))
```

```{r analisis_cluster_en_data, echo=FALSE}
data$Cluster <- as.factor(km$cluster)
# Ver las primeras filas de la tabla con la nueva columna de clusters
head(data)
```
